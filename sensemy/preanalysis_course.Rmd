---
title: "Pre Analysis top 7 edges: deciding the course."
output: html_notebook
---

#Setting dataframe. 
```{r echo=FALSE}
# Setting the dataframe. 

df_superhotedges_april16pt <- df_speed_top_p

df_superhotedges_april16pt$time <- as.POSIXct(df_superhotedges_april16pt$seconds, origin="1970-01-01")

df_superhotedges_april16pt <- df_superhotedges_april16pt %>% 
  filter(hour(time) >=8, hour(time)<= 20, wday(time) != 1 , wday(time) != 7 ) 

df_superhotedges_april16pt$course <- factor(df_superhotedges_april16pt$course)

#Create column day/night
df$dayNight <- ifelse(df$DateTime > df$sunRise & df$DateTime < df$sunSet, 'day', 'night')
```


## Option 1 
```{r echo=FALSE}
# Adding course to the top 7 edges. 

df_speed_top$course <- 1

#Vertical
df_speed_top_p[(df_speed_top_p$way_id == 35145521 ) & df_speed_top_p$track > 90 & df_speed_top_p$track < 270,]$course <- 2

df_speed_top_p[(df_speed_top_p$way_id == 37141970 | df_speed_top_p$way_id == 316459169) & (df_speed_top_p$track < 90 | df_speed_top_p$track > 270),]$course <- 2


#Horizontals
df_speed_top_p[(df_speed_top_p$way_id == 63192525 | df_speed_top_p$way_id == 106334851) &   df_speed_top_p$track < 180,]$course <- 2
df_speed_top_p[df_speed_top_p$way_id == 35078500  &   df_speed_top_p$track > 180,]$course <- 2



```


### All points. 
```{r echo=FALSE}
tseries_light2 <- function(index) { df_superhotedges_april16pt %>% 
    filter( way_id == df_osm_edge_ids[index,1] ) %>% 
    ggplot(aes(x= time, y= (speed*18)/5)) + 
    geom_point(aes(colour = factor(course)), alpha = 1/10) + 
    ylab("Speed(km/h)") + 
    xlab("Date")+ 
    ggtitle(paste("Time series of speed for way_id:",df_osm_edge_ids[index,2],df_osm_edge_ids[index,1], sep = " " ))}

lapply(1, FUN = tseries_light2)
```

### By hour
```{r echo=FALSE}
df_superhotedges_april16pt %>% 
  group_by(way_id) %>% 
  ggplot(aes(x = hour(time), y= track)) +
  geom_point(aes(colour = course), alpha = 1/20) +
  facet_wrap(~ way_id)
```

## General 

```{r}
 df_superhotedges_april16pt %>% 
    merge(y = df_osm_edge_ids , using = way_id) %>% 
    ggplot(aes(x= track, fill = factor(way_id))) + 
    geom_histogram(binwidth = 45) +
    facet_wrap(~type) +
    scale_x_continuous(breaks = seq(0,400,45))

```


```{r echo=FALSE}
df_superhotedges_april16pt %>% 
    merge(y = df_osm_edge_ids , using = way_id) %>% 
    ggplot(aes(x=hour(time) ,y= track)) + 
    geom_point(aes(colour = factor(way_id)), alpha = 1/50) +
    facet_wrap(~type) 
```

```{r echo=FALSE}
df_superhotedges_april16pt %>% 
    merge(y = df_osm_edge_ids , using = way_id) %>% 
    subset(way_id == 35145521) %>% 
    ggplot(aes(x= track)) + 
    geom_histogram(binwidth = 45) +
    facet_wrap(~factor(hour(time))) 
```

```{r}
dens2 <-df_superhotedges_april16pt %>% 
  merge(y = df_osm_edge_ids, using = way_id) %>% 
  ggplot(aes(x= track)) +
  geom_density(aes(group=factor(address), color=address)) + 
  ggtitle("Density of course grade(without weekends)") + 
  xlab("Grades(º)") +
  ylab("Density") +
  facet_wrap(~type)

ggplotly(dens2)  
```

```{r echo=FALSE}
dens3 <-df_superhotedges_april16pt %>% 
  merge(y = df_osm_edge_ids, using = way_id) %>% 
  ggplot(aes(x= track)) +
  scale_y_continuous(c(0,0.1))+
  geom_density(aes(group=factor(type), color=type)) + 
  ggtitle("Density of course grade(without weekends)") + 
  xlab("Grades(º)") +
  ylab("Density") +
  facet_wrap(~hour(time)) 

ggplotly(dens3)  
```

```{r echo=FALSE}
dens_h <-  function(hr) { 

df_superhotedges_april16pt %>% 
  merge(y = df_osm_edge_ids, using = way_id) %>% 
  filter(hour(time) == hr) %>% 
  ggplot(aes(x= track)) +
  geom_density(aes(group=factor(address), color=address)) + 
  ggtitle("Density of course grade(without weekends)") + 
  xlab("Grades(º)") +
  ylab("Density") 

}

lapply(8, FUN = dens_h)
```


```{r}
df_superhotedges_april16pt %>% 
  filter(way_id == df_osm_edge_ids[index,1] ) %>% 
  ggplot(aes(x= track, fill = factor(course))) + 
    geom_histogram(binwidth = 45) +
  facet_wrap(~hour(time))
```

```{r}
dens_hr2 <- function(index) {  df_superhotedges_april16pt %>% 
  filter( way_id == df_osm_edge_ids[index,1]) %>% 
  merge(y = df_osm_edge_ids, using = way_id) %>% 
  ggplot(aes(x= track)) +
  geom_density(aes(group=factor(hour(time)), color=factor(hour(time)))) + 
  ggtitle(paste("Density of course grade(without weekends)",df_osm_edge_ids[index,2],df_osm_edge_ids[index,1], sep = " " )) + 
  xlab("Grades(º)") +
  ylab("Density") 
          
}

lapply(1:7, FUN = dens_hr2)
```

```{r}
dens_hr3 <- function(index) {  df_superhotedges_april16pt %>% 
  filter( way_id == df_osm_edge_ids[index,1]) %>% 
  merge(y = df_osm_edge_ids, using = way_id) %>% 
  ggplot(aes(x= track)) +
  geom_density(aes(group=factor(course), color=factor(course))) + 
  ggtitle(paste("Density of course grade(without weekends)",df_osm_edge_ids[index,2],df_osm_edge_ids[index,1], sep = " " )) + 
  xlab("Grades(º)") +
  ylab("Density") 
          
}

lapply(1:7, FUN = dens_hr3)
```



